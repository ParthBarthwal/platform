# Migration `20200624195700-init`

This migration has been generated by Angad Singh at 6/24/2020, 7:57:00 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `cryptocracy`.`User` (
`admin` boolean NOT NULL DEFAULT false ,`bountyBanned` boolean NOT NULL DEFAULT false ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`currentTileId` int NOT NULL ,`discord` varchar(191) NOT NULL  ,`discordVerified` boolean NOT NULL DEFAULT false ,`dqed` boolean NOT NULL DEFAULT false ,`edu` varchar(191)   ,`email` varchar(191) NOT NULL  ,`emailVerified` boolean NOT NULL DEFAULT false ,`hasHintCard` boolean NOT NULL DEFAULT false ,`id` int NOT NULL  AUTO_INCREMENT,`incarcerated` boolean NOT NULL DEFAULT false ,`incarceratedAt` datetime(3)   ,`name` varchar(191)   ,`password` varchar(191)   ,`points` int NOT NULL DEFAULT 0 ,`timesPassedGo` int NOT NULL DEFAULT 1 ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`username` varchar(191) NOT NULL  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`Tile` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`levelId` int  ,`mysteryTileOpen` boolean NOT NULL DEFAULT false ,`number` int   ,`story` json   ,`type` ENUM('STORY', 'LEVEL', 'RAND_PERSON', 'RAND_CHANCE', 'GO', 'JAIL', 'GATE', 'GATEI', 'MYSTERY', 'CENTER') NOT NULL  ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`VisitedTile` (
`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`guardPassed` boolean   ,`id` int NOT NULL  AUTO_INCREMENT,`randomChanceType` ENUM('JAIL', 'BRIBE', 'BOUNTY')   ,`randomPersonType` ENUM('ALLY', 'PICKPOCKET', 'SPHINX', 'GUARD', 'VILLAGER')   ,`riddleId` int  ,`tileId` int NOT NULL ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`Level` (
`answer` varchar(191) NOT NULL  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`level` json NOT NULL  ,`points` int NOT NULL  ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`UserLevel` (
`completed` boolean NOT NULL DEFAULT false ,`completedAt` datetime(3)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`levelId` int NOT NULL ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`Riddle` (
`answer` varchar(191) NOT NULL  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`points` int NOT NULL  ,`riddle` json NOT NULL  ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`LevelAttempt` (
`attempt` varchar(191) NOT NULL  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`levelId` int NOT NULL ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`userId` int NOT NULL ,`userLevelId` int  ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`UserRiddle` (
`completed` boolean NOT NULL DEFAULT false ,`completedAt` datetime(3)   ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`riddleId` int NOT NULL ,`tileId` int NOT NULL ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`RiddleAttempt` (
`attempt` varchar(191) NOT NULL  ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`id` int NOT NULL  AUTO_INCREMENT,`riddleId` int NOT NULL ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `cryptocracy`.`Log` (
`adminOnly` boolean NOT NULL DEFAULT false ,`createdAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`flagged` boolean NOT NULL DEFAULT false ,`id` int NOT NULL  AUTO_INCREMENT,`log` json NOT NULL  ,`updatedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ,`userId` int NOT NULL ,
    PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE UNIQUE INDEX `User.email` ON `cryptocracy`.`User`(`email`)

CREATE UNIQUE INDEX `User.username` ON `cryptocracy`.`User`(`username`)

CREATE UNIQUE INDEX `User.discord` ON `cryptocracy`.`User`(`discord`)

CREATE UNIQUE INDEX `Tile.number` ON `cryptocracy`.`Tile`(`number`)

ALTER TABLE `cryptocracy`.`User` ADD FOREIGN KEY (`currentTileId`) REFERENCES `cryptocracy`.`Tile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`Tile` ADD FOREIGN KEY (`levelId`) REFERENCES `cryptocracy`.`Level`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`VisitedTile` ADD FOREIGN KEY (`userId`) REFERENCES `cryptocracy`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`VisitedTile` ADD FOREIGN KEY (`tileId`) REFERENCES `cryptocracy`.`Tile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`VisitedTile` ADD FOREIGN KEY (`riddleId`) REFERENCES `cryptocracy`.`Riddle`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`UserLevel` ADD FOREIGN KEY (`userId`) REFERENCES `cryptocracy`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`UserLevel` ADD FOREIGN KEY (`levelId`) REFERENCES `cryptocracy`.`Level`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`LevelAttempt` ADD FOREIGN KEY (`levelId`) REFERENCES `cryptocracy`.`Level`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`LevelAttempt` ADD FOREIGN KEY (`userId`) REFERENCES `cryptocracy`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`LevelAttempt` ADD FOREIGN KEY (`userLevelId`) REFERENCES `cryptocracy`.`UserLevel`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`UserRiddle` ADD FOREIGN KEY (`userId`) REFERENCES `cryptocracy`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`UserRiddle` ADD FOREIGN KEY (`riddleId`) REFERENCES `cryptocracy`.`Riddle`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`UserRiddle` ADD FOREIGN KEY (`tileId`) REFERENCES `cryptocracy`.`VisitedTile`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`RiddleAttempt` ADD FOREIGN KEY (`riddleId`) REFERENCES `cryptocracy`.`Riddle`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`RiddleAttempt` ADD FOREIGN KEY (`userId`) REFERENCES `cryptocracy`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `cryptocracy`.`Log` ADD FOREIGN KEY (`userId`) REFERENCES `cryptocracy`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200624195700-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,189 @@
+datasource db {
+  provider = "mysql"
+  url      = env("MYSQL_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum RandomPerson {
+  ALLY
+  PICKPOCKET
+  SPHINX
+  GUARD
+  VILLAGER
+}
+
+enum RandomChance {
+  JAIL
+  BRIBE
+  BOUNTY
+}
+
+enum TileType {
+  STORY
+  LEVEL
+  RAND_PERSON
+  RAND_CHANCE
+  GO
+  JAIL
+  GATE
+  GATEI
+  MYSTERY
+  CENTER
+}
+
+model User {
+  id              Int       @id @default(autoincrement())
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt @default(now())
+  email           String    @unique
+  emailVerified   Boolean   @default(false)
+  username        String    @unique
+  timesPassedGo   Int       @default(1)
+  name            String?
+  password        String?
+  discord         String    @unique
+  discordVerified Boolean   @default(false)
+  edu             String?
+  points          Int       @default(0)
+  admin           Boolean   @default(false)
+  incarcerated    Boolean   @default(false)
+  incarceratedAt  DateTime?
+  bountyBanned    Boolean   @default(false)
+  dqed            Boolean   @default(false)
+  hasHintCard     Boolean   @default(false)
+  currentTileId   Int
+  currentTile     Tile      @relation(fields: [currentTileId], references: [id])
+
+  logs          Log[]
+  levels        UserLevel[]
+  riddles       UserRiddle[]
+  visitedTiles  VisitedTile[]
+  levelAttempt  LevelAttempt[]
+  riddleAttempt RiddleAttempt[]
+}
+
+model Tile {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+  type      TileType
+  number    Int?     @unique
+
+  // Level tile
+  levelId Int?
+  level   Level? @relation(fields: [levelId], references: [id])
+
+  // Story tile
+  story Json?
+
+  // Mystery tile
+  mysteryTileOpen Boolean @default(false)
+
+  visits      VisitedTile[]
+  usersOnTile User[]
+}
+
+model VisitedTile {
+  id               Int           @id @default(autoincrement())
+  createdAt        DateTime      @default(now())
+  updatedAt        DateTime      @updatedAt @default(now())
+  userId           Int
+  user             User          @relation(fields: [userId], references: [id])
+  tileId           Int
+  tile             Tile          @relation(fields: [tileId], references: [id])
+  guardPassed      Boolean?
+  randomPersonType RandomPerson?
+  riddleId         Int?
+  riddle           Riddle?       @relation(fields: [riddleId], references: [id])
+  randomChanceType RandomChance?
+  UserRiddle       UserRiddle[]
+}
+
+model Level {
+  id           Int            @id @default(autoincrement())
+  createdAt    DateTime       @default(now())
+  updatedAt    DateTime       @updatedAt @default(now())
+  level        Json
+  points       Int
+  answer       String
+  userLvls     UserLevel[]
+  tiles        Tile[]
+  LevelAttempt LevelAttempt[]
+}
+
+model UserLevel {
+  id          Int            @id @default(autoincrement())
+  createdAt   DateTime       @default(now())
+  updatedAt   DateTime       @updatedAt @default(now())
+  userId      Int
+  user        User           @relation(fields: [userId], references: [id])
+  levelId     Int
+  level       Level          @relation(fields: [levelId], references: [id])
+  completed   Boolean        @default(false)
+  completedAt DateTime?
+  attempts    LevelAttempt[]
+}
+
+model Riddle {
+  id            Int             @id @default(autoincrement())
+  createdAt     DateTime        @default(now())
+  updatedAt     DateTime        @updatedAt @default(now())
+  riddle        Json
+  answer        String
+  points        Int
+  completed     UserRiddle[]
+  tiles         VisitedTile[]
+  RiddleAttempt RiddleAttempt[]
+}
+
+model LevelAttempt {
+  id          Int        @id @default(autoincrement())
+  createdAt   DateTime   @default(now())
+  updatedAt   DateTime   @updatedAt @default(now())
+  levelId     Int
+  level       Level      @relation(fields: [levelId], references: [id])
+  userId      Int
+  user        User       @relation(fields: [userId], references: [id])
+  attempt     String
+  UserLevel   UserLevel? @relation(fields: [userLevelId], references: [id])
+  userLevelId Int?
+}
+
+model UserRiddle {
+  id          Int         @id @default(autoincrement())
+  createdAt   DateTime    @default(now())
+  updatedAt   DateTime    @updatedAt @default(now())
+  userId      Int
+  user        User        @relation(fields: [userId], references: [id])
+  riddleId    Int
+  riddle      Riddle      @relation(fields: [riddleId], references: [id])
+  completed   Boolean     @default(false)
+  completedAt DateTime?
+  tileId      Int
+  tile        VisitedTile @relation(fields: [tileId], references: [id])
+}
+
+model RiddleAttempt {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+  riddleId  Int
+  riddle    Riddle   @relation(fields: [riddleId], references: [id])
+  attempt   String
+  userId    Int
+  user      User     @relation(fields: [userId], references: [id])
+}
+
+model Log {
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt @default(now())
+  userId    Int
+  user      User     @relation(fields: [userId], references: [id])
+  log       Json
+  adminOnly Boolean  @default(false)
+  flagged   Boolean  @default(false)
+}
```


